# Vue-amap笔记

## 安装

npm下载

```javascript
npm install vue-amap --save
```

main.js引入

```javascript
import './plugin/aMaps.js' //文件我已经提前写好，引入即可
```

## 基本组件

```javascript
<el-amap vid="amapContainer" class="amap-demo" :events="events"></el-amap>
<div id="panel" style="height: 300px; overflow: auto;"></div>//路线绘制
```

center为地图打开时的焦点，zoom为打开时的地图缩放程度，event为绑定的事件

## 使用

```javascript
import { AMapManager,lazyAMapApiLoaderInstance} from 'vue-amap';//需要使用的组件引入地图实例
import {getCurrentPosition} from './getCurrentPosition.js'
import {getLocation} from './getLocalCity.js'
import {path_programming} from './path_programming.js'
import {searchResult} from './map/search.js'
```

```javascript
//mounted
		lazyAMapApiLoaderInstance.load().then(() => {//地图懒加载
		    const map = new AMap.Map('amapContainer', {//创建地图实例
		        resizeEnable: true,
		        center: [116.397428, 39.90923],
		        zoom: 5
		    });
			const that = this
		
		    getCurrentPosition(map,(data)=>{//获取当前定位经纬度
		       // console.log("getCurrentPosition")
			   this.$store.state.startLngLat = []
			   this.$store.state.startLngLat.push(data.R)
			   this.$store.state.startLngLat.push(data.Q)
		        console.log(this.$store.state.startLngLat)
		    })
		    path_programming(map,that,(data)=>{//获取导航规划路径
		       // console.log("path_programming")
		       // console.log(data)
		    })
		    getLocation(map,(data)=>{//获取当前定位城市
				//console.log("getLocation")
				//console.log(data)
				//console.log(data.replace("市",""))
			})
            searchResult(map,this.destination,(data)=>{//获取导航规划路径
                console.log("searchResult")
                console.log(data)
            })
		})
```

## 地图API

### 获取当前位置经纬度

//getCurrentPosition

```javascript
//import { AMapManager,lazyAMapApiLoaderInstance} from 'vue-amap';//需要使用的组件引入地图实例

export const getCurrentPosition=(map,callback)=>{
		map.plugin('AMap.Geolocation', function () {
			const geolocation = new AMap.Geolocation({
				enableHighAccuracy: true,//是否使用高精度定位，默认:true
				timeout: 10000,          //超过10秒后停止定位，默认：无穷大
				maximumAge: 0,           //定位结果缓存0毫秒，默认：0
				convert: true,           //自动偏移坐标，偏移后的坐标为高德坐标，默认：true
				showButton: true,        //显示定位按钮，默认：true
				buttonPosition: 'LB',    //定位按钮停靠位置，默认：'LB'，左下角
				buttonOffset: new AMap.Pixel(10, 20),//定位按钮与设置的停靠位置的偏移量，默认：Pixel(10, 20)
				showMarker: true,        //定位成功后在定位到的位置显示点标记，默认：true
				showCircle: true,        //定位成功后用圆圈表示定位精度范围，默认：true
				panToLocation: true,     //定位成功后将定位到的位置作为地图中心点，默认：true
				zoomToAccuracy:true ,     //定位成功后调整地图视野范围使定位位置及精度范围视野内可见，默认：false
				extensions:'base'
			});
			map.addControl(geolocation); 
			geolocation.getCurrentPosition((status,result)=>{
				if(status=='complete'){
					callback(result.position)
				}else{
					callback(result)
				}
			});
			geolocation.getCityInfo((status,result)=>{
				callback(result)
			})
			AMap.event.addListener(geolocation, 'complete', onComplete);//返回定位信息
			AMap.event.addListener(geolocation, 'error', onError);      //返回定位出错信息
		//});
		
	})
}

```

### 获取当前定位城市

//getLocation

```javascript
export const getLocation=(map,callback)=>{
		//AMap.CitySearch
	map.plugin('AMap.CitySearch', function () {
		//实例化城市查询类
		const citysearch = new AMap.CitySearch();
		//自动获取用户IP，返回当前城市
		//console.log(citysearch.getLocalCity)
		citysearch.getLocalCity(function(status, result) {
			console.log(result)
			console.log(status)
			if (status === 'complete' && result.info === 'OK') {
				if (result && result.city && result.bounds) {
					console.log(result)
					const cityinfo = result.city;
					const citybounds = result.bounds;
					callback(cityinfo)
					//地图显示当前城市
					map.setBounds(citybounds);
				}
			} else {
				callback(result.info)
			}
		});
	})
}
```

### 获取驾车路线规划

//path_programming

```javascript
//规划路线
export const path_programming=(map,that,callback)=>{
	console.log(that.$store.state.startLngLat)
	map.plugin('AMap.Driving',()=>{
		const driving = new AMap.Driving({
			 policy: AMap.DrivingPolicy.LEAST_TIME,
			 map: map,
			 panel: "panel"
		})
		console.log(that.$store.state.startLngLat)
		const startLngLat = that.$store.state.startLngLat//第一个是经度，第二个是纬度，写反了就定位到外国去了，没有权限
		const endLngLat = that.$store.state.endLngLat
		driving.search(startLngLat, endLngLat, function (status, result) {
			//console.log(result)
		// 未出错时，result即是对应的路线规划方案
			if (result.info === 'OK') {
				if (result) {
					callback({start:result.start,end:result.end})
				}
			} else {
				callback(result.info)
			}
		})
		
	}) 
	
}
```

### 搜索地点获取经纬度

```java
export const searchResult =(map,keyword,callback)=> {
    console.log(keyword)
    AMap.plugin('map.PlaceSearch', function(){
        var autoOptions = {
            city: '全国'
        }
        var placeSearch = new AMap.PlaceSearch(autoOptions);
        placeSearch.search(keyword, function(status, result) {
            // 搜索成功时，result即是对应的匹配数据
            // var node = new PrettyJSON.view.Node({
            //     //el: document.querySelector("#input-info"),
            //     data: result
            // });
            callback(result)
        })
    })
}
```


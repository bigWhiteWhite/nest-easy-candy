# pnpm 安装

https://www.pnpm.cn/cli/env

```js
// Using PowerShell:
iwr https://get.pnpm.io/install.ps1 -useb | iex
// 安装不同的node版本，报错就重启电脑
pnpm env use --global 16
```

# 快速删除 node_modules

```js
// 全局安装rimraf：
npm install rimraf -g
// 到你的项目根目录下（即有node_modules的目录)
rimraf node_modules
```

# Git

- 当有冲突的时候，将**master 合并到准备提交**的分支，在分支里面解决完冲突以后在继续申请合并
- 当写的代码搞错了分支时或者不想某些功能立刻推上分支，可以使用文件贮藏
  - https://segmentfault.com/a/1190000023924418
  - https://git-scm.com/book/zh/v2/Git-%E5%B7%A5%E5%85%B7-%E8%B4%AE%E8%97%8F%E4%B8%8E%E6%B8%85%E7%90%86
  - https://blog.csdn.net/jaihk662/article/details/89195671

## 其他分支强制推送覆盖master

```bash
git push -f origin 其他分支:master
```

## master 回滚

- 拉取 master

- ```ts
  git reset --hard <commit 标记；例如ba6344b9>
  ```

- gitlab 取消 master 分支保护，强制推送 git push -f origin master

## 代码回滚

**sourceTree**回滚代码到指定版本

1. 打开**sourceTree**，选中分支，找到需要**回滚**的版本，右击选择“重置当前分支到此次提交”
2. 选择强行合并
3. 回滚提交
4. 找到最新的版本，右击，选择“将 xx 重置到此这提交”选择“软合并”
5. 提交**代码**，这时候你会发现修改了一些文件需要提交，选中提交即可，这样就会将**代码回滚**到了指定版本。

## `.gitignore` 文件没有生效

如果你发现 `.gitignore` 文件没有生效，你可以尝试以下步骤：

1. **检查 `.gitignore` 文件的位置**： `.gitignore` 文件应该在你的 git 仓库的根目录下。
2. **检查 `.gitignore` 文件的语法**：你可能在 `.gitignore` 文件中使用了错误的语法或者格式，你需要确保每一行只包含一个模式，你可以在此查看正确的语法：https://git-scm.com/docs/gitignore
3. **清除 git 缓存**：如果你已经使用 git 追踪（track）了一些应该被 `.gitignore` 忽略的文件，你需要手动取消跟踪这些文件。你可以通过下面的命令清除 git 缓存：

```
git rm -r --cached .
```

然后再次添加所有文件：

```
git add .
```

然后再提交：

```
git commit -m "Clear git cache"
```

这将会重新添加所有文件，并且在添加文件时会应用 `.gitignore` 文件的规则。被 `.gitignore` 文件规则匹配到的文件不会再被追踪。

1. **确定你的 `.gitignore` 文件没有被其他的配置文件覆盖**：例如你的项目可能有一个全局的 `.gitignore` 文件，或者你的 git 配置中可能有一个 `core.excludesfile` 配置项，这些都可能覆盖你的本地 `.gitignore` 文件的规则。

## 合并某个文件

可以使用 Git 的命令行工具来合并一个特定的文件。下面是如何从一个分支将一个文件合并到当前分支的命令：

```bash
git checkout <branch_name> -- <file_path>
```

在这条命令中，`<branch_name>` 是你想从其中获取文件的分支的名称，`<file_path>` 是你想合并的文件的路径。执行这个命令后，`<file_path>` 文件的内容将变成 `<branch_name>` 分支上该文件的内容。你可以将这个改动提交到你的分支。

注意，这个命令可能会覆盖你在当前分支上对这个文件所做的所有改动。在执行这个命令之前，你应该确保你不会丢失任何重要的改动。

如果你想要从`add-app`分支上获取`src/language/en-US.ts`文件并将其合并到你当前所在的分支，你可以在命令行中使用以下命令：

```bash
git checkout add-app -- src/language/en-US.ts
git checkout fix-auto-import -- components/AppDrag.vue
```

这将把你在`add-app`分支上的`src/language/en-US.ts`文件的内容复制到你当前所在的分支。

然后，你可以使用`git status`查看这个文件是否已经改变。如果已经改变，你可以使用`git add src/language/en-US.ts`来将这个文件添加到待提交更改的列表，然后使用`git commit -m "your commit message"`来提交这个更改。

这个命令并不会合并两个版本的文件，它只是用`add-app`分支上的文件版本替换当前分支上的文件。如果你想要手动合并这两个文件的内容，你可能需要使用合适的文本编辑器或者合并工具来做这个工作。

# 封装二次组件上传 npm

## npm

- **package.json**

  - ```js
    {
        "name": "ant-awesome-vue",
        "version": "0.1.0", // 每一次发版都要更新这里
        "description": "基于AntDesign封装",
        "main": "lib/ant-awesome-vue.umd.min",
        "private": false, // 不可以为true,要开源
  
        "scripts": {
        "serve": "vue-cli-service serve",
        "prettier": "prettier --write .",
        "build": "vue-cli-service build",
        "package": "vue-cli-service build --target lib ./src/package/index.js --name  ant-awesome-vue --dest lib"
        },
    }
    ```

- **npm 命令**

  - ```js
    npm login
    npm publish
    ```

# react

## 返回界面倒计时

https://www.cnblogs.com/yesu/p/10973743.html

```js
// 生命周期中，将倒计时数字存入本地
const localTime = window.localStorage.getItem('PageTime') || 30
if (parseInt(localTime) >= 0) {
	// 取出本地倒计时进行判断
	this.setState(() => ({
		time: parseInt(localTime)
	}))
}
const setTime = setInterval(() => {
	if (this.state.time > 0) {
		this.setState((preTime) => ({
			time: preTime.time--
		}))
	}
	// 将倒计时数字存入本地
	window.localStorage.setItem('PageTime', this.state.time)
	if (this.state.time <= 0) {
		clearInterval(setTime)
	}
}, 1000)
```

## 模板字符串点击事件

https://www.its203.com/article/weixin_40141473/118642688

将事件绑定到 window 对象，然后在组件挂载的时候赋值给他

```js
let contentStr = `<p onclick="aRegister()">我是模板字符串，点击我。</p>`

aRegister() {
    console.log('123')
}

componentDidMount() {
    window.aRegister = this.aRegister; // 模板字符串中的链接跳转
}
```

# vue

## vue2 引入 ts 文件

https://cherrow.top/posts/5141e527

```js
"dependencies": {
    "webpack": "4.5.0"
}
"devDependencies": {
    "typescript": "^4.7.2",
    "eslint": "^5.16.0",
    "eslint-plugin-vue": "^5.0.0",
    "fork-ts-checker-webpack-plugin": "^7.2.11",
    "babel-eslint": "^10.0.3",
    "@types/node": "^17.0.36",
    "@types/webpack-env": "^1.17.0",
}
```

```js
// 错误： Class extends value undefined is not a constructor or null
yarn add webpack --save-dev // 升级webpack
```

```js
yarn add typescript ts-loader@8.2.0 fork-ts-checker-webpack-plugin --dev
// vue.config.js
const ForkTsCheckerWebpackPlugin = require('fork-ts-checker-webpack-plugin')
module.exports = {
  configureWebpack: {
    // 入口文件根据项目实际情况填写，如不写，默认为 main.js
    entry: './src/main.ts',
    resolve: { extensions: ['.ts', '.tsx'] },
    module: {
      rules: [
        {
          // 解析 ts 与 tsx 文件
          test: /\.tsx?$/,
          loader: 'ts-loader',
          exclude: /node_modules/,
          options: {
            transpileOnly: true,
            appendTsSuffixTo: [/\.vue$/],
            happyPackMode: false,
          },
        },
      ],
    },
    plugins: [
      // 用于提供完善的报错信息
      new ForkTsCheckerWebpackPlugin({
        async: false,
        typescript: {
          // 提供对 .vue 单文件的检测支持
          extensions: {
            vue: true,
          },
        },
      }),
    ],
  },
}
```

## 图片预览

https://www.linnyuu.com/home/detail/ce6605499d084599bf439f0eb1891bad

```js
vue2：
yarn add v-viewer

vue3：
yarn add v-viewer@next
```

**引入**

```js
import 'viewerjs/dist/viewer.css'
import VueViewer from 'v-viewer'
Vue.use(VueViewer)
```

使用方式

```vue
<template>
	<div>
		<!-- 指令 -->
		<div class="images" v-viewer>
			<img v-for="src in images" :key="src" :src="src" />
		</div>
		<!-- 图片直接使用指令，不用数组也可以 -->
		<img v-viewer :src="scope.row.pictureUrl" />
		<!-- 组件 -->
		<viewer :images="images">
			<img v-for="src in images" :key="src" :src="src" />
		</viewer>
		<!-- api -->
		<button type="button" @click="show">Click to show</button>
	</div>
</template>
<script>
import 'viewerjs/dist/viewer.css'
import VueViewer from 'v-viewer'
import Vue from 'vue'
Vue.use(VueViewer)
export default {
	data() {
		return {
			images: ['https://picsum.photos/200/200', 'https://picsum.photos/300/200', 'https://picsum.photos/250/200']
		}
	},
	methods: {
		show() {
			this.$viewerApi({
				images: this.images
			})
		}
	}
}
</script>
```

## 补充组件传递

https://www.csdn.net/tags/MtTaEgxsNTA4NDQ2LWJsb2cO0O0O.html

```js
// vue调用孙子组件的方法
this.$refs.child.$refs.grandson.test()
```

**通过组件的 emit、on 方法**

子组件 child.vue：

```vue
<template>
	<div>我是子组件</div>
</template>
<script>
export default {
	mounted() {
		// 挂载的时候就一直监听有没有启用这个方法
		this.$nextTick(function () {
			this.$on('childFun', function () {
				console.log('我是子组件方法')
			})
		})
	}
}
</script>
```

父组件：

```vue
<template>
	<div>
		<Button @click="handleClick">点击调用子组件方法</Button>
		<Child ref="child" />
	</div>
</template>

<script>
import Child from './child'

export default {
	methods: {
		handleClick() {
			this.$refs.child.$emit('childFun') //子组件$on中的名字
		}
	}
}
</script>
```

## 多页面应用

https://juejin.cn/post/6844903949657440264 基础

https://www.cnblogs.com/fqh123/p/11981646.html

https://www.jb51.net/article/182741.htm 解决 history

https://www.jianshu.com/p/d61a658e1d2c

**vue.config.js**

view 下面放着多个界面的**main.js, router.js, index.vue, index.less**等文件

```js
//配置src/view页面获取当前文件夹下的html和js
const pagePath = (globPath) => {
	let entries = {}
	glob.sync(globPath).forEach((entry) => {
		let filename = entry.split('src/views/')[1]
		let middlePath = filename.split('/main.js')[0]
		let dirList = middlePath.split('/')
		entries[dirList[dirList.length - 1]] = {
			entry: 'src/views/' + middlePath + '/main.js',
			template: `public/${middlePath}/index.html`,
			filename: middlePath + '/index.html'
		}
	})
	// console.log(entries)
	return entries
}
module.exports = {
	// 多界面配置,引入view下面的文件
	pages: pagePath('src/views/*')
}
```

**public**

在 public 下面添加 index.html 文件，public/文件夹名字/index.html,这样是为了可以访问的时候去掉 html

**每个界面都有各自的 main.js**

**main.js**

```js
import Vue from 'vue'
import App from './index.vue'
import router from './router'
import '@/plugins' // 通用的插件
import './index.less'

Vue.config.productionTip = false
new Vue({
	router,
	render: (h) => h(App)
}).$mount('#privacyPolicy')
```

### 问题

- public 文件下面的文件大小写没有被 git 检测到

- 检查文件的类型是否是正确的，会不会出现 js 解析成 html 的问题

- 解决方法是，静态文件的路径不对

  - http://localhost:8085/app-h5/PrivacyPolicy/?app=kashway 测试地址

  - https://testhk5.xcreditech.com/app-h5/PrivacyPolicy/index.html?app=kashway

  - 在 app-h5 下面的文件，要改变 vue.config.vue 的 publicPath

  - ```js
    module.exports = {
    	publicPath: '/app-h5/'
    }
    ```

### 路由跳转

https://www.jianshu.com/p/f9de91927f1f

https://www.pianshen.com/article/5027537211/

我们配置后，其实不难看出，只是多了出口和入口并不能，用统一一个 router 搞定页面之前的跳转，所以，我这边，用的是单页，即同一入口出口，文件我们用 router，页面与页面之间（即 indtx.html 与 test.htms）的跳转，用 location.href

```
window.location.href = '/test.html'
```

配置完后，上传打包，我们会发现，跳转并不是我们想想中的那样，他的根目录不同了需要我们做一点处理，这里我想到了两个方案

方案一： 配置地址根目录

即，在每一个入口文件.js 里加上一个公共的变量，挂在 vue 上当然，你也可以挂到 window 上。

```
/* 定义不同入口，跳转路径配置 index.js*/
if (location.hostname === 'localhost') {
  Vue.prototype.HTTPLOCAT = ''
} else {
  const http = window.location.protocol + '//' + location.hostname + ':' + location.port
  Vue.prototype.HTTPLOCAT = http + '/netopenws/wt/vue/dist' // （这个路径改为你服务器的路径）
}
```

接下来页面的跳转用就好了。

```
window.location.href = this.HTTPLOCAT + '/test.html'
```

## @img 引入

https://blog.csdn.net/qq_31126175/article/details/99550889

```vue
<template>
	<div>
		1.<img src="~@/assets/logo.png" alt="" /> 2.<img :src="img" alt="" /> 3.<div class="box imgurl"></div> 4.<div
			class="box"
			:style="{ background: 'url(' + img + ')' }"
		></div>
		5.<div :style="`background-image: url(${!$store.getters.GetIsH5 ? first_bg : h5_first_bg});`"> </div>
	</div>
</template>

<script>
export default {
	data() {
		return {
			img: require('@/assets/logo.png'),
			first_bg: require('@/assets/ke-img/AboutUs/first-bg.webp'),
			h5_first_bg: require('@/assets/ke-img/AboutUs/h5-first-bg.webp')
		}
	}
}
</script>

<style scoped>
.box {
	height: 200px;
	width: 200px;
	display: inline-block;
}
.imgurl {
	background: url('~@/assets/logo.png');
}
</style>
```

- require 不接受变量，只接受字符串

```js
const getImg = (imgName) => {
    let svgPath = ''
    if (process.env.NODE_ENV === 'development') {
        svgPath = require(`@/assets/static-af/Kenya/kashway/privacyPolicy/${imgName}.svg`)
    } else {
        svgPath = `${getImgCdn('kashway')}/privacyPolicy/${imgName}.svg`
    }
    return svgPath
}

getImg('sms_chat'),
```

## 引入代码表单样式改变

- .html 中写样式
- 定位加 padding

## 修改 User-Agent 请求头

[CSDN](https://blog.csdn.net/qazwsxrx/article/details/112315683)

谷歌插件:1：User-Agent Switcher for Chrome 2：User-Agent Switcher and Manager

- 手动修改 -> 打开 f12，三点，更多工具，网络状况，用户代理

## whistle 代理

- 下载插件**Proxy SwitchyOmega**

- 情景模式：proxy 启用以后所有的网址都会转去代理，**浏览器先转去 whistle 的端口地址，whistle 再帮我们转去设定好的代理地址**

  - | 网址协议 | 代理协议    | 代理服务器 | 代理端口 |
    | -------- | ----------- | ---------- | -------- |
    | (默认)   | http        | 127.0.0.1  | 8899     |
    | http://  | http        | 127.0.0.1  | 8899     |
    | https:// | http (关键) | 127.0.0.1  | 8899     |

- 情景模式：auto switch 只有符合的才会代理

  - 条件中可以写 whistle 中的项目网址

  - | 条件类型   | 条件设置             | 情景模式 |
    | ---------- | -------------------- | -------- |
    | 域名通配符 | internal.example.com | 直接连接 |
    | 域名通配符 | mangucash.com        | proxy    |

https://wproxy.org/whistle/webui/https.html **https 证书问题，要勾上选项捕捉 https 请求**

- w2 配置不要加/home

- ```js
  # Bees Credit Website
  https://beescredit.com   http://127.0.0.1:7060
  https://beescredit.com pattern referer://https://beescredit.com
  # presta24贷超站点
  https://www.presta24.com/   http://127.0.0.1:7063
  https://www.presta24.com/ pattern referer://https://presta24.com
  # app-website
  https://ipesa.cc http://127.0.0.1:7063
  https://ipesa.cc pattern referer://https://ipesa.cc
  https://kashway.cc http://127.0.0.1:7063
  https://kashway.cc pattern referer://https://kashway.cc
  https://www.kashway.cc http://127.0.0.1:7063
  https://www.kashway.cc pattern referer://https://www.kashway.cc
  https://creditmoja.com http://127.0.0.1:7063
  https://creditmoja.com pattern referer://https://creditmoja.com
  https://tifislice.com http://127.0.0.1:7063
  https://tifislice.com pattern referer://https://tifislice.com
  https://mocash.cc http://127.0.0.1:7063
  https://mocash.cc pattern referer://https://mocash.cc
  https://credit9ja.cc http://127.0.0.1:7063
  https://credit9ja.cc pattern referer://https://credit9ja.cc
  https://naira9ja.cc http://127.0.0.1:7063
  https://naira9ja.cc pattern referer://https://naira9ja.cc
  https://9jacash.cc http://127.0.0.1:7063
  https://9jacash.cc pattern referer://https://9jacash.cc
  https://nownowmoney.cc http://127.0.0.1:7063
  https://nownowmoney.cc pattern referer://https://nownowmoney.cc
  https://imoneyplus.cc http://127.0.0.1:7063
  https://imoneyplus.cc pattern referer://https://imoneyplus.cc
  https://nairago.cc http://127.0.0.1:7063
  https://nairago.cc pattern referer://https://nairago.cc
  https://joycash.cc http://127.0.0.1:7063
  https://joycash.cc pattern referer://https://joycash.cc
  https://kabilcash.com http://127.0.0.1:7063
  https://kabilcash.com pattern referer://https://kabilcash.com
  https://creavicash.com http://127.0.0.1:7063
  https://creavicash.com pattern referer://https://creavicash.com
  https://ipeso.cc http://127.0.0.1:7063
  https://ipeso.cc pattern referer://https://ipeso.cc
  https://xpeso.cc http://127.0.0.1:7063
  https://xpeso.cc pattern referer://https://xpeso.cc
  https://maxcredito.cc http://127.0.0.1:7063
  https://maxcredito.cc pattern referer://https://maxcredito.cc
  https://mcredito.cc http://127.0.0.1:7063
  https://mcredito.cc pattern referer://https://mcredito.cc
  https://justocredito.com http://127.0.0.1:7063
  https://justocredito.com pattern referer://https://justocredito.com
  https://icredito.cc http://127.0.0.1:7063
  https://icredito.cc pattern referer://https://icredito.cc
  https://xfectivo.com http://127.0.0.1:7063
  https://xfectivo.com pattern referer://https://xfectivo.com
  https://xcredito.cc http://127.0.0.1:7063
  https://xcredito.cc pattern referer://https://xcredito.cc
  https://isolez.cc http://127.0.0.1:7063
  https://isolez.cc pattern referer://https://isolez.cc
  https://cplatinka.com http://127.0.0.1:7063
  https://cplatinka.com pattern referer://https://cplatinka.com
  https://creditaco.com http://127.0.0.1:7063
  https://creditaco.com pattern referer://https://creditaco.com
  https://credifio.com http://127.0.0.1:7063
  https://credifio.com pattern referer://https://credifio.com
  https://mexacash.com http://127.0.0.1:7063
  https://mexacash.com pattern referer://https://mexacash.com
  https://ucredit.cc http://127.0.0.1:7063
  https://ucredit.cc pattern referer://https://ucredit.cc
  https://mangucash.com http://127.0.0.1:7063
  https://mangucash.com pattern referer://https://mangucash.com
  https://isente.cc http://127.0.0.1:7063
  https://isente.cc pattern referer://https://isente.cc
  https://quicksente.com http://127.0.0.1:7063
  https://quicksente.com pattern referer://https://quicksente.com
  https://faircredit.tech http://127.0.0.1:7063
  https://faircredit.tech pattern referer://https://faircredit.tech
  https://ikori.cc http://127.0.0.1:7063
  https://ikori.cc pattern referer://https://ikori.cc
  https://kolque.com http://127.0.0.1:7063
  https://kolque.com pattern referer://https://kolque.com
  https://solcash.cc http://127.0.0.1:7063
  https://solcash.cc pattern referer://https://solcash.cc
  https://parcecredit.com http://127.0.0.1:7063
  https://parcecredit.com pattern referer://https://parcecredit.com
  https://credifio.cc http://127.0.0.1:7063
  https://credifio.cc pattern referer://https://credifio.cc
  https://cololana.com http://127.0.0.1:7063
  https://cololana.com pattern referer://https://cololana.com
  https://bacanoplata.com http://127.0.0.1:7063
  https://bacanoplata.com pattern referer://https://bacanoplata.com
  https://iluca.cc http://127.0.0.1:7063
  https://iluca.cc pattern referer://https://iluca.cc
  https://inspiretech.app http://127.0.0.1:7063
  https://inspiretech.app pattern referer://https://inspiretech.app
  https://loaninspire.com http://127.0.0.1:7063
  https://loaninspire.com pattern referer://https://loaninspire.com
  https://taccash.cc http://127.0.0.1:7113
  https://taccash.cc pattern referer://https://taccash.cc
  ```

## 配置启动命令变量

配置启动命令变量，来使得启动时可以启动不同的项目

**package.json**

```js
"scripts": {
    "serve:kenya": "vue-cli-service serve --kenya",
    "serve:mexico": "vue-cli-service serve --mexico",
    "build:kenya": "vue-cli-service build --kenya",
    "build:mexico": "vue-cli-service build --mexico",
},
```

**vue.config.js**

直接添加全局变量

```js
const argv = process.argv
module.exports = {
	// 配置自定义环境变量
	chainWebpack: (config) => {
		config.plugin('define').tap((args) => {
			args[0].CLIENT = JSON.stringify(argv)
			return args
		})
	}
}
```

**router.js**

```js
let routes = []
if (CLIENT[3] === '--kenya') {
	routes = [{}]
} else if (CLIENT[3] === '--mexico') {
	routes = [{}]
}
```

## 导出下载后端文件

在 Web 开发中，当我们处理文件时（创建，上传，下载），经常会遇到二进制数据。不过，在 JavaScript 中有很多种二进制数据格式，会有点容易混淆。`arraybuffer`，`uint8Array`，`dataView`，`blob`，`file`。

**axios**拦截

```js
let myData = response.data
if (response.config.responseType === 'arraybuffer') {
	// arraybuffer会转换为二进制对象 通过decode解析 如果是返回文件则解析失败 则直接返回对应文件
	try {
		const enc = new TextDecoder('utf-8')
		const json = JSON.parse(enc.decode(new Uint8Array(myData))) // 转换code 进行判断

		if (response.config.notify) {
			Message.error(json.msg || '请求异常')
			return Promise.reject(json)
		}
	} catch (error) {
		return myData
	}
}
```

**调用**

```js
// 要主动声明接口文件类型
export const ApiExportLoanList = (data, app) => {
	return proxy({
		url: `/${app}/company-manage/order/exportLoanList`,
		method: 'post',
		data,
		responseType: 'arraybuffer' // 表明返回服务器返回的数据类型
	})
}
```

**如果后端直接给出了文件在服务器中的地址**，可以直接使用 a 标签或 window.open

```js
window.open（“文件在服务器中的地址”）
```

### blob 类型

**content-type**

Content-Type 即内容类型，Content-Type 用于定义网络文件的类型和网页的编码，决定文件接收方将以什么形式、什么编码读取这个文件，这就是经常看到一些网页点击的结果却是下载到的一个文件或一张图片的原因。

ContentType 属性指定响应的 HTTP 内容类型。如果未指定 ContentType，默认为 TEXT/HTML。

我们在代码也经常需要定义 ContentType，用于指定响应的类型

```js
response.setCharacterEncoding('utf-8')
response.setContentType('text/html;charset=utf-8')
```

```js
// https://www.w3school.com.cn/media/media_mimeref.asp 所有的类型
const typeMap = {
    html: 'text/html', // HTML格式
    plain: 'text/plain', // 纯文本格式
    xml: 'text/xml', // XML格式
    gif: 'image/gif', // gif图片格式
    jpeg: 'image/jpeg', // jpg图片格式
    png: 'image/png', // png图片格式
    xmlData: 'application/xml', // XML数据格式
    json: 'application/json', // XML数据格式
    pdf: 'application/pdf', // pdf格式
    'octet-stream': 'application/octet-stream',
    doc: 'application/msword',
    dot: 'application/msword',
    docx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    dotx: 'application/vnd.openxmlformats-officedocument.wordprocessingml.template',
    docm: 'application/vnd.ms-word.document.macroEnabled.12',
    dotm: 'application/vnd.ms-word.template.macroEnabled.12',
    xls: 'application/vnd.ms-excel',
    xlt: 'application/vnd.ms-excel',
    xla: 'application/vnd.ms-excel',
    xlsx: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
    xltx: 'application/vnd.openxmlformats-officedocument.spreadsheetml.template',
    xlsm: 'application/vnd.ms-excel.sheet.macroEnabled.12'
    xltm: 'application/vnd.ms-excel.template.macroEnabled.12',
    xlam: 'application/vnd.ms-excel.addin.macroEnabled.12',
    xlsb: 'application/vnd.ms-excel.sheet.binary.macroEnabled.12',
    ppt: 'application/vnd.ms-powerpoint',
    pot: 'application/vnd.ms-powerpoint',
    pps: 'application/vnd.ms-powerpoint',
    ppa: 'application/vnd.ms-powerpoint',
    pptx: 'application/vnd.openxmlformats-officedocument.presentationml.presentation',
    potx: 'application/vnd.openxmlformats-officedocument.presentationml.template',
    ppsx: 'application/vnd.openxmlformats-officedocument.presentationml.slideshow',
    ppam: 'application/vnd.ms-powerpoint.addin.macroEnabled.12',
    pptm: 'application/vnd.ms-powerpoint.presentation.macroEnabled.12',
    potm: 'application/vnd.ms-powerpoint.template.macroEnabled.12',
    ppsm: 'application/vnd.ms-powerpoint.slideshow.macroEnabled.12'
}
```

**下载多种文件核心函数**

```js
export const downloadMain = (data, name = '', type = 'zip') => {
	if (!data) return
	const typeMap = {
		//这里需要根据不同的文件格式写不同的参数
		word: 'application/msword;charset=utf-8',
		excel: 'application/vnd.ms-excel;charset=utf-8',
		// 需要在axios中指明 responseType: "arraybuffer"
		excelBuffer: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet;charset=utf-8',
		zip: 'application/zip'
	}
	const blob = new Blob([data], {
		type: typeMap[type]
	})
	// 创建a标签
	const link = document.createElement('a')
	// 创建下载的链接
	link.style.display = 'none'
	link.href = window.URL.createObjectURL(blob)
	// 下载后文件名
	const fileName = name || 'file'
	link.download = excelName

	document.body.appendChild(link)
	link.click()
	document.body.removeChild(link)
	window.URL.revokeObjectURL(href) // 释放掉blob对象
}

// 使用
downloadFile(res, 'fileName', 'excel') // 接受后端返回的blob数据
```

## script 变量

添加变量

```js
"scripts": {
    "serve:kenya": "vue-cli-service serve --kenya",
    "serve:mexico": "vue-cli-service serve --mexico",
    "build:kenya": "vue-cli-service build --kenya",
    "build:mexico": "vue-cli-service build --mexico",
    "prettier": "prettier --write .",
    "lint": "vue-cli-service lint"
},
```

目前直接在项目中查看 process.argv，数组为空(使用 node 启动的文件可以获取的到)，解决方法是在 vue.config.js 中将值付给全局变量

```js
const argv = process.argv

module.exports = {
	// 配置自定义环境变量
	chainWebpack: (config) => {
		config.plugin('define').tap((args) => {
			args[0].CLIENT = JSON.stringify(argv)
			return args
		})
	}
}
```

## 事件总线

```js
// Vue.prototype.$EventBus = new Vue()
// 想要传数据出去的组件
mounted () {
    // 挂载事件总线,使用数据总线传递数据
    this.$EventBus.$emit(this.queryName, this.formData)
},
beforeDestroy () {
    this.$EventBus.$off()
}
// 想要获取数据的组件
methods: {
    getSearchData () {
      // 事件总线获取搜索表单最新的值
      this.$EventBus.$on(this.queryName, (_) => {
        this.searchData = _
      })
    }
},
beforeDestroy () {
    this.$EventBus.$off()
}
```

## vue2 和 nuxt 引入 swiper

```js
"swiper": "^6.3.2",
"vue-awesome-swiper": "^4.1.1",

import Swiper2, { Mousewheel } from 'swiper'
import { Swiper, SwiperSlide } from 'vue-awesome-swiper'
import 'swiper/swiper-bundle.css'
Swiper2.use([Mousewheel]) // swiper6以上都是需要使用模块的形式
```

## vue.config 添加解析文件

https://www.jianshu.com/p/3accd17be50b

```js
// 解析xlsx文件
chainWebpack: config => {
	// 禁用vue应用内部对[svg]的处理,也可以禁用其他默认解析文件
    config.module.rule ('svg').exclude.add (resolve ('./src/icons/svg'));
    // 新建规则处理xlsx文件
	config.module.rule('xlsx') // 规则名
      .test(/\.(csv|xlsx|xsl)$/) // 添加匹配规则
      .include.add(resolve('./src/assets'))// 添加我们要处理的文件路径
      .end() // 上面的add方法改变了上下文，调用end()退回到include这一级
      .use('file-loader') // 使用"file-loader"这个依赖
      .loader('file-loader')// 选中这个依赖
      .options({
        limit: 10,
        name: '[name].[ext]'
      }) // 传入配置
},
```

## Element

### **el-input 输入框**

在输入时不允许输入小数，使用正则表达式校验然后代替

https://bbchin.com/archives/input-limit

[普通 input 使用 oninput](https://juejin.cn/post/6899361465384812557)

| 规则 | 公式 | 用法 |
| --- | --- | --- |
| 只能输入数字(正整数) | value=value.replace(/[^\d]/g, '') | oninput = |
| 只能输入数字（包含正负数） | value=value.replace(/[^\-\d]/g, '') |  |
| 只能输入数字和小数 | value=value.replace(/[^\-\d.]/g, '') |  |
| 只能输入数字和小数，只保留一个小数点 | value=value.replace(/[^\d.]/g, '').replace(/^(\d+)\.(\d\d).\*$/, '$1.$2') |  |
| 只能输入数字和小数，只保留一个小数点(包含负数) | value=value.replace(/[^\-\d.]/g, '').replace(/^(\-)_(\d+)\.(\d+)._$/, '$1$2.$3') |  |
| 只能输入数字和小数，只保留一个小数点，只保留 2 位小数(包含负数) | value=value.replace(/[^\-\d.]/g, '').replace(/^(\-)_(\d+)\.(\d\d)._$/, '$1$2.$3') |  |
| 只能输入数字和小数，只保留一个小数点，只保留 3 位小数(包含负数) | value=value.replace(/[^\-\d.]/g, '').replace(/^(\-)_(\d+)\.(\d${3})._$/, '$1$2.$3') |  |
| 只能输入数字和小数，只保留一个小数点，只保留 3 位小数(包含负数) | value=value.replace(/[^\-\d.]/g, '').replace(/(\.)(\d*)(\1*)/g,'$1$2').replace(/^(\-)*(\d+)\.(\d{2}).*$/, '$1.$2') |  |
| 超出 6 位不显示 | if(value.length > 6) value=value.substring(0,6) |  |
| 不允许输入小数点 | value=value.replace(/[^\d]/g,'') |  |
| 只能输入大小写字母、数字、下划线 | value=value.replace(/[^\w_]/g,'') |  |
| 只能输入小写字母、数字、下划线 | value=value.replace(/[^a-z0-9_]/g,'') |  |
| 只能输入数字和点 | value=value.replace(/[^\d.]/g,'') |  |
| 只能输入中文 | value=value.replace(/[^\u4e00-\u9fa5]/g,'') |  |
| 只能输入英文 | value=value.replace(/[^a-za-z]/g,'') |  |
| 只能输入中文、数字、英文 | value=value.replace(/[^\w\u4e00-\u9fa5]/g, '') |  |
| 只能输入数字和字母 | value=value.replace(/[\W]/g,'') |  |
| 除了英文的标点符号以外，其他的都可以中文，英文字母，数字，中文标点 | value=value.replace(/^[^!@#$%^&*()-=+]/g,'') |  |
| 只能输入英文字母和数字,不能输入中文 | value=value.replace(/[^\w\.\/]/ig,'') |  |
| 小数点后只能有最多两位(数字,中文都可输入),不能输入字母和运算符号: |  |  |
| 小数点后只能有最多两位(数字,字母,中文都可输入),可以输入运算符号 | value=value.replace(/^(\-)_(\d+)\.(\d\d)._$/,'$1$2.$3') |  |
|  |  |  |

```js
<el-input
    type="number"
    oninput ="value=value.replace(/[^\d]/g,'')"
    v-model.number="item.fixedCharge"
    @change="changeCharge(index)"
/>
```

复杂的输入控制

```vue
<template>
	<el-input type="number" @input="fixedChargeRule(value, index)" v-model.number="item.fixedCharge" />
</template>
<script>
export default {
	methods: {
		fixedChargeRule(value, index) {
			const newValue = value.replace(/[^\d]/g, '') // 不允许出现小数
			if (this.isMx && value.length > 4) {
				// 墨西哥不允许超过4位数
				this.$set(this.feeList[index], 'fixedCharge', newValue.substring(0, 4))
			}
		}
	}
}
</script>
```

### el-autocomplete 自动

[正则表达式验证邮箱格式](https://blog.csdn.net/levon2018/article/details/80779322?ops_request_misc={%22request_id%22:%22163851627516780265434925%22,%22scm%22:%2220140713.130102334..%22}&request_id=163851627516780265434925&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-4-80779322.first_rank_v2_pc_rank_v29&utm_term=%e9%82%ae%e7%ae%b1%e6%a0%bc%e5%bc%8f%e6%a0%a1%e9%aa%8c&spm=1018.2226.3001.4187)

```js
^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$
```

```js
import { Autocomplete } from 'element-ui'

<el-autocomplete
    size="small"
    style="width: 100%"
    v-model="homeEmail"
    :fetch-suggestions="querySearchEmail"
    :trigger-on-focus="false"
></el-autocomplete>

// 邮箱填写过滤
createFilter(queryString) {
    return (item) => {
        return item.value.toLowerCase().indexOf(queryString.toLowerCase()) === 0
    }
},
// 邮箱自动填充后缀名
querySearchEmail(queryString, callback) {
    const emailList = [
        { value: '@gmail.com' },
        { value: '@yahoo.com' },
        { value: '@ymail.com' },
        { value: '@live.com' },
        { value: '@hotmail.com' },
        { value: '@aol.com' },
        { value: '@webmail.co.za' },
        { value: '@vodamail.co.za' },
        { value: '@iafrica.com' }
    ]
    let results = []
    let queryList = []
    emailList.map((item) => {
        queryList.push({ value: queryString.split('@')[0] + item.value })
    })
    results = queryString ? queryList.filter(this.createFilter(queryString)) : queryList
    callback(results)
},
```

### **el-input-number 计数器**

在输入时不允许输入小数,从键盘中禁止，火狐可能会失效，加上输入方法限制

```vue
<el-input-number
	:style="{ width: '150px' }"
	:min="2"
	:max="4"
	:step="1"
	step-strictly
	onKeypress="return (/[\d]/.test(String.fromCharCode(event.keyCode)))"
	@input="inputNum"
></el-input-number>
<script>
export default {
	methods: {
		inputNum(e) {
			e = (e + '').replace(/[^\d.]/g, '') * 1
		}
	}
}
</script>
```

### el-upload 上传文件

[文档](https://element.eleme.cn/#/zh-CN/component/upload)

- http-request---覆盖默认的上传行为，可以自定义上传的实现

```vue
<el-upload ref="uploadRef" drag :multiple="false" :file-list="fileList" :http-request="uploadProxy" :on-remove="onRemoveFile">

</el-upload>
<script>
export default {
	methods: {
		uploadProxy(params) {
			if (this.fileList.length >= 1) {
				this.$message({
					message: this.$t('company.plzDelUpload'),
					type: 'error'
				})
				this.uploadError(params.file)
				return
			}
			const formData = new FormData()
			formData.append('file', params.file)
			formData.append('appId', this.prefixApi)

			this.loading = true
			proxy({
				method: 'post',
				url: '接口地址',
				data: formData
			})
				.then((res) => {
					this.filePath = res.filePath || ''
				})
				.catch((err) => {
					this.uploadError(params.file)
				})
				.finally(() => {
					const { uploadRef } = this.$refs
					this.fileList = uploadRef.uploadFiles
					this.loading = false
				})
		},
		uploadError(file) {
			// 删除上传失败文件
			const { uploadRef } = this.$refs
			const { uid } = file
			const idx = uploadRef.uploadFiles.findIndex((item) => item.uid === uid)
			uploadRef.uploadFiles.splice(idx, 1)
		}
	}
}
</script>
```

### el-upload+裁剪图片

```vue
yarn add vue-cropper
```

[简书](https://www.jianshu.com/p/85a52da879bb) [git-vue_cropper](https://github.com/xyxiao001/vue-cropper)

```vue
<template>
	<div>
		<el-row>
			<el-col :span="3">
				<el-upload
					v-loading="loading"
					:auto-upload="false"
					:action="logoUploadUrl"
					class="avatar-uploader"
					:show-file-list="false"
					:http-request="avatarUpload"
					:on-change="changeUpload"
				>
					<i class="el-icon-plus avatar-uploader-icon"></i>
				</el-upload>
			</el-col>
			<el-col :span="3" v-show="logoUrl">
				<div class="avatar-uploader showImg">
					<img :src="logoUrl" class="avatar" />
				</div>
			</el-col>
			<el-col :span="3" v-if="logoUrl">
				<button class="deleteImage" @click="clearAvatar">Delete</button>
			</el-col>
		</el-row>
		<p>
			<span style="color: #929393; font-weight: bold">Supported logo format:</span> .jpg / .png
			<span style="color: #929393; font-weight: bold">Logo size : </span>< 50px
		</p>
		<!-- vueCropper 剪裁图片实现-->
		<div v-show="dialogVisible">
			<!-- <el-dialog title="图片剪裁" append-to-body :visible.sync="dialogVisible"> -->
			<div class="cropper-content">
				<div class="cropper" style="text-align:center">
					<vueCropper
						ref="cropper"
						:img="option.img"
						:outputSize="option.size"
						:outputType="option.outputType"
						:info="true"
						:full="option.full"
						:canMove="option.canMove"
						:canMoveBox="option.canMoveBox"
						:original="option.original"
						:autoCrop="option.autoCrop"
						:fixed="option.fixed"
						:fixedNumber="option.fixedNumber"
						:centerBox="option.centerBox"
						:infoTrue="option.infoTrue"
						:fixedBox="option.fixedBox"
					></vueCropper>
				</div>
			</div>
			<div slot="footer" class="dialog-footer">
				<el-button @click="dialogVisible = false">取 消</el-button>
				<el-button type="primary" :loading="cro_loading" @click="finish">确认</el-button>
			</div>
			<!-- </el-dialog> -->
		</div>
	</div>
</template>

<script>
import { mapGetters } from 'vuex'
import { ApiCompanyUploadLogo } from '@/api/company'
import { proxy } from '@/plugins/axios'
export default {
	props: {
		companyLogo: {
			type: String,
			default: ''
		}
	},
	data() {
		return {
			dialogVisible: false,
			avatarUrl: this.companyLogo,
			loading: false,
			option: {
				img: '', // 裁剪图片的地址
				info: true, // 裁剪框的大小信息
				outputSize: 0.8, // 裁剪生成图片的质量
				outputType: 'jpeg', // 裁剪生成图片的格式
				canScale: false, // 图片是否允许滚轮缩放
				autoCrop: true, // 是否默认生成截图框
				// autoCropWidth: 300, // 默认生成截图框宽度
				// autoCropHeight: 200, // 默认生成截图框高度
				fixedBox: true, // 固定截图框大小 不允许改变
				fixed: true, // 是否开启截图框宽高固定比例
				fixedNumber: [5, 5], // 截图框的宽高比例
				full: true, // 是否输出原图比例的截图
				canMoveBox: false, // 截图框能否拖动
				original: false, // 上传图片按照原始比例渲染
				centerBox: false, // 截图框是否被限制在图片里面
				infoTrue: true // true 为展示真实输出图片宽高 false 展示看到的截图框宽高
			},
			cro_loading: false
		}
	},
	computed: {
		...mapGetters(['role', 'enumerate']),
		prefixApi() {
			const sys = this.role.curSystem
			return (sys && sys.prefixApi) || 'Tifi'
		},
		logoUploadUrl() {
			return `/${this.prefixApi}${ApiCompanyUploadLogo}` // api
		},
		logoUrl() {
			return this.avatarUrl
		}
	},
	methods: {
		clearAvatar() {
			// 清除logo图片
			this.avatarUrl = ''
		},
		avatarUpload(params) {
			// 上传图片
			this.avatarUrl = '' // 清空原来的图片
			const formData = new FormData()
			formData.append('file', params)
			formData.append('appId', this.prefixApi)
			this.loading = true
			proxy({
				method: 'post',
				url: this.logoUploadUrl,
				data: formData
			})
				.then((res) => {
					this.avatarUrl = res
					this.cro_loading = false
					this.dialogVisible = false
				})
				.finally(() => {
					this.loading = false
				})
		},
		// 转换为blob
		getBlob(file) {
			let url
			if (window.createObjectURL !== undefined) {
				// basic
				url = window.createObjectURL(file)
			} else if (window.URL !== undefined) {
				// mozilla(firefox)
				url = window.URL.createObjectURL(file)
			} else if (window.webkitURL !== undefined) {
				// webkit or chrome
				url = window.webkitURL.createObjectURL(file)
			}
			return url
		},
		getFile(blob, fileName) {
			const arr = blob.split(';base64,') //[data:image/png,xxx]
			const mime = arr[0].replace('data:', '') //mime后端识别用的文件格式数据
			const fileType = mime.split('/').pop() //获取文件格式
			const bstr = atob(arr[1]) //base64解码
			//创建Unicode编码的数组对象，每个值都是Unicode
			const u8arr = new Uint8Array(bstr.split('').map((str) => str.charCodeAt(0)))
			return new File([u8arr], `${fileName ? fileName : 'file'}.${fileType}`, { type: mime })
		},
		changeUpload(file) {
			const imgType = file.raw.type === 'image/jpeg' || file.raw.type === 'image/png'
			const maxSize = file.raw.size / 1024 / 1024 < 0.05
			if (!imgType || !maxSize) {
				this.$message.error('Wrong image format')
				return false
			}
			const url = this.getBlob(file.raw)

			this.$nextTick(() => {
				this.option.img = url
				this.dialogVisible = true
			})
			return true
		},
		// 点击裁剪，这一步是可以拿到处理后的地址
		finish() {
			this.$refs.cropper.getCropData((data) => {
				this.cro_loading = true
				const res = this.getFile(data, 'companyLogo')
				this.avatarUpload(res)
			})
		}
	}
}
</script>

<style scoped lang="less">
.avatar-uploader {
	/deep/ .el-upload {
		border: 1px dashed #d9d9d9;
		border-radius: 6px;
		cursor: pointer;
		position: relative;
		overflow: hidden;
		&:hover {
			border-color: #409eff;
		}
	}
}
.avatar-uploader-icon {
	font-size: 28px;
	color: #8c939d;
	width: 128px;
	height: 128px;
	line-height: 128px;
	text-align: center;
}
.avatar {
	width: 128px;
	height: 128px;
	display: block;
}
.showImg {
	width: 128px;
	height: 128px;
	border: 1px dashed #d9d9d9;
	border-radius: 6px;
	cursor: pointer;
	position: relative;
	overflow: hidden;
}
.deleteImage {
	cursor: pointer;
	border: none;
	background-color: #f36d6c;
	color: #fff;
	padding: 10px 30px;
	border-radius: 5px;
	margin-top: 95px;
}

.cropper-content {
	.cropper {
		width: auto;
		height: 300px;
	}
}
</style>
```

### 修改 element 样式

修改基础组件的样式，例如颜色等

```scss
// 就是安装element的时候要引入的css
@import '~element-ui/packages/theme-chalk/lib/message.css';
// @import "~element-ui/packages/theme-chalk/lib/tabs.css";
// @import "~element-ui/packages/theme-chalk/lib/tab-pane.css";
body {
	@theme-color: #4371C2;
	.el-menu {
		@bg: #28283B;
		@color: #fff;
		@active-bg: #4371C2;

		border-right: 0;
		background-color: @bg;
		.is-opened {
			.el-submenu__title {
				color: #fff;
			}
		}
		.el-submenu__title {
			color: hsla(0, 0%, 100%, 0.65);
			&:hover,
			&:focus {
				background-color: transparent;
				color: #fff;
			}
			.svg-wrap {
				padding-right: 10px;
			}
		}
	}
}
```

### 配置项给 input 添加规则

```js
export const personStaffForm = {
    formMain: [
        {
            value: 'firstName',
            type: 'input',
            label: 'First name',
            ruleVariate: {
                // 输入规则的变量
                maxLength: 4
            }
        }
}
```

```vue
<el-input @input="formItem.inputRule && formItem.inputRule(value[formItem.value], index, ...formItem.ruleVariate)" />
```

- 在 computed 中返回表单对象,目的是对表单对象进行处理,不需要可以直接在 data 中返回
  - this.firstNameInputRule 函数做值得规则限制
  - this.filterRule 是对表单中的哪个数据做限制

```vue
<script>
import { personStaffForm } from './sample.config'
export default {
	computed: {
		personStaffForm() {
			const formMain = this.filterRule(personStaffForm.formMain, [
				{
					// 可以添加多个复杂的校验规则
					firstName: this.firstNameInputRule
				}
			])
			return { ...personStaffForm, formMain }
		}
	},
	methods: {
		numMaxRule(value, index, ruleVariate) {
			// 只能为数字， 最大为maxLength位数
			const key_value = value.replace(/[^\d]/g, '')
			this.$set(this.personData, 'firstName', key_value.substring(0, ruleVariate.maxLength || 10))
		},
		filterRule(_, keyFun, name = 'inputRule') {
			// 表单数组， 所有要改动的规则数组， 函数名
			_.forEach((item) => {
				for (let obj of keyFun) {
					if (obj[item.value]) {
						item[name] = obj[item.value]
					}
				}
			})
			return _
		}
	}
}
</script>
```

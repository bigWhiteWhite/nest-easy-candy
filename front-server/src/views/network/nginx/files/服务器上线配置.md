# 宝塔

- sudo su root
- /etc/init.d/bt default //打开面板
- `wget -O install.sh http://download.bt.cn/install/install-ubuntu_6.0.sh && sudo bash install.sh`
- 打开网址，查看账户密码登陆
- 复制启动 js 文件放在宝塔中的文件夹中，目录一般在`/www/wwwroot/`，可以新建文件夹
- 下载 pm2 托管，指向刚才的服务器文件
- 点击**网站**，**添加站点**

## 题库

# 服务器

### 转移到 linux 的更改

```java
npm i -g serve //调试
serve dist
```

### node-sass 的问题

```javascript
//配置安装源
npm config set sass_binary_site https://npm.taobao.org/mirrors/node-sass/
//npm i
```

参考

```javascript
npm i node-sass@4.14.1 --sass_binary_site=https://npm.taobao.org/mirrors/node-sass/


npm uninstall --save node-sass
npm install --save node-sass

npm rebuild node-sass   //重新安装sass

npm cache clean
npm install --save node-sass
```

### 文件夹操作

```javascript
sudo su root
# 删除一个空目录
rm -d 目录名
# 删除一个空目录
rm -dir 目录名
# 删除一个非空目录
rm -r 目录名
# 删除文件
rm 文件名
# 删除文件（使用超级管理员权限）
sudo rm 文件名
```

### 挂载共享文件夹

```javascript
/usr/bin/vmhgfs-fuse .host:/share  /mnt/hgfs/share  -o subtype=vmhgfs-fuse,allow_other
//要进入终端特权模式   sudo su root
//要设置虚拟机的共享，文件的共享，我的电脑映射网络驱动器
```

## 基本步骤

解决接口，创建.env.development，写入

```javascript
VUE_APP_API_URL = http://localhost:3000/admin/api
```

axios 中

```java
const http = axios.create({
  // 加了斜杠，前缀默认为域名地址
  baseURL: process.env.VUE_APP_API_URL || '/admin/api/'
})
```

配置打包 config/index.js

```javascript
// 配置生成文件夹位置
index: path.resolve(__dirname, '../admin/index.html'),

// 配置文件夹名字和静态文件夹名字
assetsRoot: path.resolve(__dirname, '../admin'),
assetsSubDirectory: 'static',//静态文件夹名字
assetsPublicPath: '/gray/',//默认是gray路径
//静态资源文件夹访问地址

// 前端
index: path.resolve(__dirname, '../web/index.html'),
assetsRoot: path.resolve(__dirname, '../web'),
assetsSubDirectory: 'static',
assetsPublicPath: '/',//默认是web路径

```

配置以后 npm run dev 就拿不到数据了，把 dist 文件夹托管到 node 中

网页的根路径是 index.js，所以说子目录的 gray 要更改打包文件的路径

```java
// 后台管理系统页面
app.use('/gray', express.static(`${__dirname}/gray`))
// 前端页面
app.use('/', express.static(`${__dirname}/web`))
```

### 阿里云

购买域名与服务器，服务器使用 vnc 登陆，配置看首先要添加 ip 白名单，然后去服务器的安全组设置，添加安全组，安全组规则手动添加，添加 80 和 22 端口

终端也可以登陆远程服务器

```javascript
sudo apt-get install openssh-server   //确保有这个server
sudo apt-get remove	openssh-server    //卸载
sudo /etc/init.d/ssh restart          //重新开启
service sshd status 				  //查看状态
service sshd start 					  //开启
service sshd stop 					  //结束
ssh root@     + 公网IP
```

### 腾讯云要注意

腾讯云的 ubuntu 服务器默认的用户名是 ubuntu，所以登陆 xshell6 是用 ubuntu 当用户名,里面的特权用户是 root，转换特权时是用

sudo su root

### 服务器安装

### 安装 Nginx

```javascript
apt show nginx
apt update				//更新服务器的包
apt install -y nginx

sudo apt remove nginx

//配置nginx，打开vscode的远程资源管理器
//输入服务器密码登陆,进入下面的文件夹
/etc/nginx/
//下面的配置nginx反向代理有更详细的说明将自动化配置的nginx文件拖入其中，替换文件
//记得在解压缩包的时候将sites-available里面的文件复制到sites-enabled，因为window不支持这种格式

```

### 下载 mongodb-server

```javascript
apt install -y mongodb     		//不要下载客户端
apt install -y mongodb-server	//下载服务器端
mongo							//启动
exit							//退出
```

### 下载 yarn

```js
npm i -g -yarn
yarn -v
yarn use taobao
yarn add pm2 //下载
yarn global add pm2//全局下载


//下载yrm
yarn  global add yrm
yrm use taobao
```

### 配置域名

```javascript
//域名需要一定的时间生效
```

### 下载 git

服务器的 key 不要放在个人中心，权限很大，在管理那里添加公钥

apt show 包名 //查看要下载的依赖

apt update //安装 linux 里面已有的包

```javascript
apt install -y git  //
git					//查看有无下载成功
ssh-keygen 			//生成公钥，按住enter键回车就好
//Your public key has been saved in /root/.ssh/id_rsa.pub
//生成公钥信息中的保存路径
cat + 保存路径		 //查看公钥

//项目上传使用
git init .					//创建一个git库
git remote add origin +ssh //关联远程仓库
git remote -v     		   //查看有无关联成功
git clone + ssh地址   	  //克隆远程仓库的文件
git add . 			   		//将当前目录提交到暂存区
git status  			   //查看文件状态
git commit -m "备注"   	  //提交并备注提交信息
git push origin master 	   //将本地目录提交到远程仓库
//服务器代码更新
git init .					//创建一个git库
git pull origin master 	   //更新合并远程目录到本地，master是分支名称

git branch +分支名			 //创建分支
```

### 下载 node

```javascript
apt install -y nodejs //下载
npm install npm
//淘宝镜像
npm config set registry http://registry.npm.taobao.org

npm i -g nrm	//快速切换镜像
nrm current		//查看当前下载源
nrm use npm		//切换npm下载
nrm use taobao	//切换淘宝下载

npm i -g n		//可以升级node
sudo n stable	//使用稳定版
sudo n latest	//使用最新版


//卸载
sudo apt remove nodejs

sudo apt remove npm

sudo apt remove node
//重新下载
curl -sL https://deb.nodesource.com/setup_10.x | sudo -E bash -

sudo apt-get install -y nodejs

```

### 服务器拉取代码指令

```javascript
ls
cd /							#进入
ll								#查看并显示所有文件，包括隐藏的
cd /var/www
ls
cd html
ls
mkdir data						#建立文件夹
cd /data
git clone + ssh			传递		#将文件克隆在data文件夹
ls
ll
cd serve						#进入到项目文件夹
npm i							#下载依赖
npm i -g pm2					#在后台运行nodejs
pm2 start index.js				#启动pm2
pm2 list						#查看有多少进程
pm2 logs index					#看一下logs
curl http://localhost:3000		#测试有无成功
```

### 配置 nginx 反向代理

```javascript
vscode下载remote-ssh，腾讯云的ubuntu服务器默认的用户名是ubuntu,里面的特权用户是root。
注意使用密钥登陆的话可以连接到xshell6，但是remote-ssh就访问不到了，而且绑定了密钥以后就不可以使用密码登陆，要解绑使用密码，所以说还是优先使用密码，而且安全组的端口一定要开启绑定实例，尽量使用密码登陆，多重置多几遍密码。
进入以后打开nginx的文件夹，(/etc/nginx)。
sites-enabled配置文件

mkdir#新建文件夹
rmdir#删除文件夹
进入终端建立文件
cd /
ls
cd etc
ls
cd nginx
ls
sudo su root
ls
touch hotel   #建立文件

//远程连接无法修改文件夹的问题，因为没有权限，这里将nginx修改为所有人都可以使用
//进入nginx文件夹
//chmod  777  *   -R

//生成nginx配置文件的网站
https://www.nginxedit.cn/
//输入域名，勾选掉https，暂时不需要
//配置完重载nginx
service nginx reload

//出现错误，看一下复制过来的配置文件，bigwhitehotel.top.conf
//修改路径：include nginxconfig.io/proxy.conf;  而不是什么include nginxedit.cn/proxy.conf;
//常用命令
ps -ef|grep nginx				//查看nginx进程
kill -QUIT 26562				//杀死进程  26562是进程号
pkill -9 nginx					//杀死nginx命令
nginx -t						//查看nginx是否配置成功
sudo /etc/init.d/nginx start  	//开启nginx命令
service nginx reload			//配置完重载nginx
```

修改文件夹常用命令

```javascript
https://www.cnblogs.com/viviwind/archive/2012/08/02/2619451.html
https://www.cnblogs.com/remember-forget/p/10066905.html
```

### pm2 常用命令

```javascript
// 启动类似 node xxx.js 的项目
pm2 start --name xxxsname xxx.js  # 将运行的实例命名为 xxxsname
// 启动类似 npm start 的项目
pm2 start --name appname npm -- start # 设置应用名为 appname
// 启动类似 npm run serve 的项目
pm2 start --name servename npm -- run serve # 设置应用名为 servename
// 以配置文件的形式启动
pm2 start pm2config.json


pm2 list               // 显示所有进程状态
pm2 ls                 // 显示所有进程状态
pm2 show 0             // 显示某个应用的详细信息
pm2 monit              // 监视所有进程
pm2 logs               // 显示所有进程日志
pm2 log 0              // 查看 0 应用的日志
pm2 stop all           // 停止所有进程
pm2 restart all        // 重启所有进程
pm2 reload all         // 0秒停机重载进程
pm2 stop 0             // 停止指定的进程，0 是应用 id
pm2 restart 0          // 重启指定的进程，0 是应用 id
pm2 startup            // 产生 init 脚本 保持进程活着，startup 是指系统boot, 开机进程自启动
pm2 unstartup          // 禁用开机进程自启动
pm2 delete 0           // 杀死指定的进程，0 是应用 id，会删除该应用
pm2 delete all         // 杀死全部进程，会删除所有应用
```

## 静态网站上线

```js
//打包好文件，然后用serve+打包文件名测试，查看有没有错误
//然后在服务器上拉取代码，如果需要更新就代码更新
git init .
git pull origin master
//pm2 serve 打包文件名 --name pm2进程名 --port 运行端口
pm2 serve vue-web  --name vue-web --port 3005
//不过会很快就下线


//使用node建立服务器，也就是建立index.js开启端口
//将打包文件放在端口里，上传代码，拉取到服务器，npm i
//然后
pm2 start --name pm2进程名 index.js
pm2 start --name vue-web index.js

```

## 经验

```js
//pm2是将静态的资源启动，也就是index.js启动起来，index里面写的端口号是什么，他就将静态资源启动在服务器的哪个端口，而nginx配置的是别人访问你的域名时默认访问的端口，域名下有多个主机记录，也就是一个域名可以有多个端口，配置nginx后，访问什么域名主机记录就默认访问什么服务器端口
//也就是服务器端口(index.js)要等于nginx配置相应的域名的端口
//如果nginx自动配置里面没有，那么也可以使用手动指定端口的方式访问到网页
```

### 端口占用

https://blog.csdn.net/whdxjbw/article/details/80681191

#### lsof 命令

```js
lsof -i:8900 // 查看
kill -9 {PID} // 消灭
```

#### node 命令

```js
ps -aux | grep node // 找到占用端口的node进程
kill -s 9 7714 // 消灭7714
```
